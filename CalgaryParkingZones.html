<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calgary Parking Map</title>
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.umd.min.js"></script>
  <link href="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
  </style>    
  </head>
  <body>
  <div id="map"></div>
  <a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>

  <script>
  maptilersdk.config.apiKey = 'thMiYdooJJCtbcD1eXd6';
  const map = new maptilersdk.Map({
    container: 'map',
    style: 'maptilersdk.MapStyle.STREETS',
    center: [-114.0719, 51.0447], // Calgary [lng, lat]
    zoom: 13
  });

  let parkingZonesData = null;

  // Fetch and store the GeoJSON
  fetch('https://data.calgary.ca/resource/rhkg-vwwp.geojson')
    .then(response => response.json())
    .then(data => {
      // Filter features for ZONE_TYPE === 'Parking Zone'
      data.features = data.features.filter(
        f => f.properties && f.properties.ZONE_TYPE === 'Parking Zone'
      );
      parkingZonesData = data;
      addParkingZonesLayer();
    });

  function addParkingZonesLayer() {
    if (!parkingZonesData || !map.getStyle()) return;
    if (map.getSource('parkingzones')) return;

    map.addSource('parkingzones', {
      type: 'geojson',
      data: parkingZonesData
    });

    // Data-driven color by PRICE_ZONE
    map.addLayer({
      id: 'parkingzones-layer',
      type: 'line',
      source: 'parkingzones',
      paint: {
        'line-color': [
          'match',
          ['get', 'PRICE_ZONE'],
          'A', '#e74c3c',   // Red
          'B', '#3498db',   // Blue
          'C', '#2ecc71',   // Green
          'D', '#f1c40f',   // Yellow
          /* other */ '#888'
        ],
        'line-width': 2
      }
    });
  }

  // Re-add the layer after every style change
  map.on('style.load', addParkingZonesLayer);
  </script>    
  </body>
</html>
